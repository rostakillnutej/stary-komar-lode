<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Lodě Socekt.IO test</title>

    <script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js" integrity="sha256-yr4fRk/GU1ehYJPAs8P4JlTgu0Hdsp4ZKrx8bDEDC3I=" crossorigin="anonymous"></script>

    <style>
      h1 {
        text-align: center;
      }

      #col {
        height: 40px;
        width: 40px;
      }

      table {
        border: solid 2px black;
        margin: 0 auto 0 auto;
      }

      td {
        height: 50px;
        width: 50px;
        background-color: white;
        margin: 5px;
        border: solid 2px black;
        cursor: pointer;
      }
    </style>

  </head>
  <body>
    <h1 id="status"></h1>
    <div>Tvoje barva:<p id="col"></p></div>


    <table id="grid">
    </table>

    <script>
      let socket = io.connect('http://' + document.domain + ':' + location.port);

      socket.on('connect', function(res) {
        document.querySelector('#status').innerHTML = 'Úspěšně připojeno na Internety';
      });

      socket.on('change_response', function(res) {
        document.querySelector('#pos' + res.x + res.y).style.backgroundColor = res.color;
        //console.log('#pos' + res.x + res.y);
      });


      createGrid();

      let color = getColors()

      let col = document.querySelector('#col');
      col.style.backgroundColor = color;

      function getColors(){
        return `rgb(${Math.floor(Math.random() * 255)},${Math.floor(Math.random() * 255)},${Math.floor(Math.random() * 255)})`;

      }

      function createGrid(){
        let maxX = 6;
        let maxY = 6;
        let e = document.querySelector('#grid');

        for(let j=0;j<maxY;j++){
          let tr = document.createElement('tr');
          for(let i=0;i<maxX;i++){
            let td = document.createElement('td');
            td.setAttribute("id", 'pos' + i + j);
            td.addEventListener("click", clicked.bind(e,i,j));
            tr.appendChild(td);
          }
          e.appendChild(tr);
        }
      }

      function clicked(x,y,e) {
        //console.log(x,y,e.target);
        e.target.style.backgroundColor = color;
        socket.emit('change', {x,y,color});
      }
    </script>

  </body>
</html>
